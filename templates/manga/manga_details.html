{% extends "base.html" %}
{% load static %}

{% block title %}{{ manga.title }}{% endblock %}

{% block head_extra %}
  {% with desc=manga.description|striptags|truncatechars:160 %}
    <meta name="description" content="{{ desc }}">
    <meta property="og:title" content="{{ manga.title }}">
    <meta property="og:description" content="{{ desc }}">
  {% endwith %}
{% endblock %}

{% block content %}
<div class="container py-8 mx-auto px-4 sm:px-6 lg:px-8">

  {# ---------- HERO SECTION ---------- #}
  {% include "manga/includes/_hero.html" %}

  {# ---------- RECOMMENDATIONS ---------- #}
  {% include "manga/includes/_recomendation.html" %}

  {# ---------- TABS: DESCRIPTION / CHAPTERS / COMMENTS ---------- #}
  <section
    x-data="{
      tab: (new URLSearchParams(location.search)).get('tab') || 'chapters',
      setTab(t){
        this.tab = t;
        const u = new URL(location);
        u.searchParams.set('tab', t);
        history.replaceState({}, '', u);
      }
    }"
  >
    <!-- Segmented control -->
    <div class="w-full sm:w-auto mt-8">
      <div class="relative grid grid-cols-3 p-1 rounded-xl bg-gray-800/60 border border-gray-700/60 backdrop-blur-sm overflow-hidden">

        <!-- sliding highlight (GRID-based, overflow qilmaydi) -->
        <div class="pointer-events-none absolute inset-1 grid grid-cols-3">
          <span
            class="col-span-1 rounded-lg bg-gradient-to-r from-indigo-500/30 to-purple-500/30
                  shadow-inner transition-all duration-300 ease-out"
            :class="tab === 'description'
              ? 'col-start-1'
              : (tab === 'chapters' ? 'col-start-2' : 'col-start-3')"
          ></span>
        </div>

        <!-- DESCRIPTION TAB BUTTON -->
        <button
          type="button"
          role="tab"
          :aria-selected="(tab === 'description').toString()"
          @click="setTab('description')"
          class="relative z-10 py-2 px-4 rounded-lg font-medium focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400
                text-xs sm:text-sm md:text-base"
          :class="tab === 'description' ? 'text-white' : 'text-gray-300 hover:text-gray-100'"
        >
          <i class="fa-solid fa-book-open mr-2 opacity-80"></i> Hikoya sharhi
        </button>

        <!-- CHAPTERS TAB BUTTON -->
        <button
          type="button"
          role="tab"
          :aria-selected="(tab === 'chapters').toString()"
          @click="setTab('chapters')"
          class="relative z-10 py-2 px-4 rounded-lg font-medium focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400
                text-xs sm:text-sm md:text-base"
          :class="tab === 'chapters' ? 'text-white' : 'text-gray-300 hover:text-gray-100'"
        >
          <i class="fa-solid fa-list-ul mr-2 opacity-80"></i> Boblar
        </button>

        <!-- COMMENTS TAB BUTTON -->
        <button
          type="button"
          role="tab"
          :aria-selected="(tab === 'comments').toString()"
          @click="setTab('comments')"
          class="relative z-10 py-2 px-4 rounded-lg font-medium focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400
                text-xs sm:text-sm md:text-base"
          :class="tab === 'comments' ? 'text-white' : 'text-gray-300 hover:text-gray-100'"
        >
          <i class="fa-solid fa-comments mr-2 opacity-80"></i> Izohlar
        </button>

      </div>
    </div>

    <!-- DESCRIPTION TAB CONTENT -->
    <div x-show="tab === 'description'" x-cloak class="mt-6">
      <div class="glass-container">
        <p class="text-gray-300 leading-relaxed text-base sm:text-lg font-light">
          {{ manga.description|linebreaksbr }}
        </p>
      </div>
    </div>


    <!-- CHAPTERS TAB CONTENT -->
    <div x-show="tab === 'chapters'" x-cloak class="mt-6">
      {% include "manga/includes/_chapter_section.html" %}
    </div>

    <!-- COMMENTS TAB CONTENT -->
    <div x-show="tab === 'comments'" x-cloak class="mt-6">
      {# Izohlar partial: kerakli faylni shu yerga include qilasan #}
      {# {% include "manga/includes/_comments.html" %} #}
    </div>
  </section>

</div>

<style>
  .glass-container { @apply bg-gray-900/30 backdrop-blur-sm rounded-2xl p-8 mb-8 border border-gray-800 shadow-2xl; }
  .tab { @apply py-2 text-sm sm:text-base text-gray-400 hover:text-gray-200 transition relative; }
  .tab-active { @apply py-2 text-sm sm:text-base font-semibold text-white relative; }
  .tab-active::after {
    content:""; position:absolute; left:0; bottom:-1px; height:3px; width:100%;
    background:#5457ff; border-radius:2px;
  }
  [x-cloak]{ display:none !important; }
</style>

<script src="{% static 'js/manga_details.js' %}"></script>
{% endblock %}
