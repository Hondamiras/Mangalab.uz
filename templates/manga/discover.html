{% extends "base.html" %}
{% load static %}
{% load cache %}

{% block content %}
<style>
  .no-scrollbar::-webkit-scrollbar { display: none; }
  .no-scrollbar { scrollbar-width: none; -ms-overflow-style: none; }
  .row-scroll { overflow-x: auto; overflow-y: hidden; }
</style>
<style>
  .navbtn{
    border-radius: 0.75rem;
    padding: .5rem;
    background: #1f2937;        /* bg-gray-800 */
    color: #e5e7eb;             /* text-gray-200 */
    border: 1px solid rgba(255,255,255,.25);
    transition: background .2s ease;
  }
  .navbtn:hover{ background:#374151; }  /* hover:bg-gray-700 */
  .navbtn:disabled{ opacity:.4; cursor:not-allowed; }
  .navbtn:focus{
    outline: 2px solid #ffffff;
    outline-offset: 2px;
  }
  .navbtn svg{ width: 1.25rem; height: 1.25rem; display:block; }
</style>

<div class="container mx-auto max-w-screen-2xl px-4 py-6">

{% if my_list.reading or my_list.planned or my_list.completed or my_list.favorite %}
<section class="mb-10" x-data="{tab:'reading'}">
  <div class="mb-3 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
    <h2 class="text-lg sm:text-xl font-semibold text-white tracking-tight">
      <span class="inline-flex items-center gap-2">
        <svg class="h-5 w-5 text-purple-400" viewBox="0 0 24 24" fill="currentColor"><path d="M7 4h10v2H7zM7 8h10v2H7zM7 12h10v2H7zM7 16h10v2H7z"/></svg>
        Mening ro‘yxatim
      </span>
    </h2>

    <div class="flex flex-wrap gap-2 sm:ml-auto">
      {% for key,label in status_tabs %}
        <button class="px-3 py-1 rounded-md text-sm"
                :class="tab==='{{ key }}' ? 'bg-purple-700 text-white' : 'bg-gray-800 text-gray-300'"
                @click="tab='{{ key }}'">{{ label }}</button>
      {% endfor %}
    </div>
  </div>

  {# reading #}
  <div x-show="tab==='reading'" x-cloak>
    <div class="flex items-center justify-end gap-2 mb-2">
      <button id="myReadingPrev" class="navbtn" aria-label="Oldingi">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M15 19l-7-7 7-7" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button id="myReadingNext" class="navbtn" aria-label="Keyingi">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M9 5l7 7-7 7" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
    <div id="myReadingRow" class="row-scroll no-scrollbar flex gap-4 snap-x snap-mandatory scroll-p-4 pr-1">
      {% for manga in my_list.reading %}
        <div class="snap-start w-36 sm:w-40 flex-shrink-0">
          <a href="{% url 'manga:manga_details' manga.slug %}">
            <div class="bg-gray-800 rounded-lg overflow-hidden shadow-lg">
              <div class="relative aspect-[3/4]">
                <img src="{{ manga.cover_image.url }}" alt="{{ manga.title }}" class="w-full h-full object-cover">
                <div class="absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black to-transparent">
                  <h3 class="text-white text-sm font-semibold truncate">{{ manga.title }}</h3>
                </div>
              </div>
            </div>
          </a>
        </div>
      {% empty %}<p class="text-gray-400">Bo‘sh.</p>{% endfor %}
    </div>
  </div>

  {# planned #}
  <div x-show="tab==='planned'" x-cloak>
    <div class="flex items-center justify-end gap-2 mb-2">
      <button id="myPlannedPrev" class="navbtn" aria-label="Oldingi">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M15 19l-7-7 7-7" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button id="myPlannedNext" class="navbtn" aria-label="Keyingi">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M9 5l7 7-7 7" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
    <div id="myPlannedRow" class="row-scroll no-scrollbar flex gap-4 snap-x snap-mandatory scroll-p-4 pr-1">
      {% for manga in my_list.planned %}
        <div class="snap-start w-36 sm:w-40 flex-shrink-0">
          <a href="{% url 'manga:manga_details' manga.slug %}">
            <div class="bg-gray-800 rounded-lg overflow-hidden shadow-lg">
              <div class="relative aspect-[3/4]">
                <img src="{{ manga.cover_image.url }}" alt="{{ manga.title }}" class="w-full h-full object-cover">
                <div class="absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black to-transparent">
                  <h3 class="text-white text-sm font-semibold truncate">{{ manga.title }}</h3>
                </div>
              </div>
            </div>
          </a>
        </div>
      {% empty %}<p class="text-gray-400">Bo‘sh.</p>{% endfor %}
    </div>
  </div>

  {# completed #}
  <div x-show="tab==='completed'" x-cloak>
    <div class="flex items-center justify-end gap-2 mb-2">
      <button id="myCompletedPrev" class="navbtn" aria-label="Oldingi">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M15 19l-7-7 7-7" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button id="myCompletedNext" class="navbtn" aria-label="Keyingi">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M9 5l7 7-7 7" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
    <div id="myCompletedRow" class="row-scroll no-scrollbar flex gap-4 snap-x snap-mandatory scroll-p-4 pr-1">
      {% for manga in my_list.completed %}
        <div class="snap-start w-36 sm:w-40 flex-shrink-0">
          <a href="{% url 'manga:manga_details' manga.slug %}">
            <div class="bg-gray-800 rounded-lg overflow-hidden shadow-lg">
              <div class="relative aspect-[3/4]">
                <img src="{{ manga.cover_image.url }}" alt="{{ manga.title }}" class="w-full h-full object-cover">
                <div class="absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black to-transparent">
                  <h3 class="text-white text-sm font-semibold truncate">{{ manga.title }}</h3>
                </div>
              </div>
            </div>
          </a>
        </div>
      {% empty %}<p class="text-gray-400">Bo‘sh.</p>{% endfor %}
    </div>
  </div>

  {# favorite #}
  <div x-show="tab==='favorite'" x-cloak>
    <div class="flex items-center justify-end gap-2 mb-2">
      <button id="myFavoritePrev" class="navbtn" aria-label="Oldingi">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M15 19l-7-7 7-7" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button id="myFavoriteNext" class="navbtn" aria-label="Keyingi">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M9 5l7 7-7 7" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
    <div id="myFavoriteRow" class="row-scroll no-scrollbar flex gap-4 snap-x snap-mandatory scroll-p-4 pr-1">
      {% for manga in my_list.favorite %}
        <div class="snap-start w-36 sm:w-40 flex-shrink-0">
          <a href="{% url 'manga:manga_details' manga.slug %}">
            <div class="bg-gray-800 rounded-lg overflow-hidden shadow-lg">
              <div class="relative aspect-[3/4]">
                <img src="{{ manga.cover_image.url }}" alt="{{ manga.title }}" class="w-full h-full object-cover">
                <div class="absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black to-transparent">
                  <h3 class="text-white text-sm font-semibold truncate">{{ manga.title }}</h3>
                </div>
              </div>
            </div>
          </a>
        </div>
      {% empty %}<p class="text-gray-400">Bo‘sh.</p>{% endfor %}
    </div>
  </div>
</section>
{% endif %}

{% cache 3600 trending_manga_section %}
<section aria-labelledby="trending-title" class="mb-10">
  <div class="flex items-center justify-between mb-3">
    <h2 id="trending-title" class="text-lg sm:text-xl font-semibold text-white tracking-tight">
      <span class="inline-flex items-center gap-2">
        <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 24 24" fill="currentColor"><path d="M13 2L3 14h7v8l11-14h-8z"/></svg>
        Trenddagi taytlar
      </span>
    </h2>
    <div class="flex items-center gap-2">
      <button id="trendingPrev" class="navbtn" aria-label="Oldingi">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M15 19l-7-7 7-7" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button id="trendingNext" class="navbtn" aria-label="Keyingi">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M9 5l7 7-7 7" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>

  <div class="relative">
    <div id="trendingRow" class="row-scroll no-scrollbar flex gap-4 overflow-x-auto snap-x snap-mandatory scroll-p-4 pr-1" role="list">
      {% for manga in trending_mangas %}
        <div role="listitem" class="snap-start w-36 sm:w-40 flex-shrink-0">
          <a href="{% url 'manga:manga_details' manga.slug %}">
            <div class="bg-gray-800 rounded-lg overflow-hidden shadow-lg">
              <div class="relative aspect-[3/4]">
                <img src="{{ manga.cover_image.url }}" alt="{{ manga.title }}" class="w-full h-full object-cover">
                <div class="absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black to-transparent">
                  <h3 class="text-white text-sm font-semibold truncate">{{ manga.title }}</h3>
                  <div class="flex justify-between items-center text-xs mt-1">
                    <span class="text-gray-300">{{ manga.type }}</span>
                    <span class="text-purple-300">{{ manga.chapters.count }} Bob</span>
                  </div>
                </div>
              </div>
            </div>
          </a>
        </div>
      {% endfor %}
    </div>
  </div>
</section>
{% endcache %}

{% if active_progress %}
<section aria-labelledby="reading-title" class="mb-10">
  <div class="flex items-center justify-between mb-3">
    <h2 id="reading-title" class="text-lg sm:text-xl font-semibold text-white tracking-tight">
      <span class="inline-flex items-center gap-2">
        <svg class="h-5 w-5 text-blue-400" viewBox="0 0 24 24" fill="currentColor">
          <path d="M3 4c0-1.1.9-2 2-2h6v18H5c-1.1 0-2-.9-2-2V4zm10-2h6c1.1 0 2 .9 2 2v14c0 1.1-.9 2-2 2h-6V2z"/>
        </svg>
        Hozir o‘qilayotganlar
      </span>
    </h2>
    <div class="flex items-center gap-2">
      <button id="readingPrev" class="navbtn" aria-label="Oldingi">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M15 19l-7-7 7-7" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button id="readingNext" class="navbtn" aria-label="Keyingi">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M9 5l7 7-7 7" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>

  <div id="readingRow"
      class="row-scroll no-scrollbar flex gap-4 overflow-x-auto snap-x snap-mandatory scroll-p-4 pr-1"
      role="list">
    {% for item in active_progress %}
      <div role="listitem" class="snap-start w-36 sm:w-40 flex-shrink-0">
        <a href="{% url 'manga:manga_details' item.manga.slug %}">
          <div class="bg-gray-800 rounded-lg overflow-hidden shadow-lg">
            <div class="relative aspect-[3/4]">
              <img src="{{ item.manga.cover_image.url }}" alt="{{ item.manga.title }}" class="w-full h-full object-cover">
              <div class="absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black to-transparent">
                <h3 class="text-white text-sm font-semibold truncate">{{ item.manga.title }}</h3>
                <div class="flex justify-between items-center text-xs mt-1">
                  <span class="text-gray-300">{{ item.manga.type }}</span>
                  <span class="text-purple-300">{{ item.manga.chapters.count }} bob</span>
                </div>
              </div>
            </div>
          </div>
        </a>
      </div>
    {% endfor %}
  </div>
</section>
{% endif %}

{% cache 300 'top_translators_section' %}
<section aria-labelledby="translators-title" class="mb-10">
  <div class="flex items-center justify-between mb-3">
    <h2 id="translators-title" class="text-lg sm:text-xl font-semibold text-white tracking-tight">
      <span class="inline-flex items-center gap-2">
        <svg class="h-5 w-5 text-amber-400" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path d="M17 3V2H7v1H3v4a4 4 0 004 4h1.1A5.002 5.002 0 0011 15v3H8v2h8v-2h-3v-3a5.002 5.002 0 002.9-4H17a4 4 0 004-4V3h-4zM7 9a2 2 0 01-2-2V5h2v4zm12-2a2 2 0 01-2 2V5h2v2z"/>
        </svg>
        Top 4 tarjimon
      </span>
    </h2>
    <a href="{% url 'accounts:top_translators' %}"
      class="text-sm text-purple-300 hover:text-purple-100 underline underline-offset-4">
      Hammasi →
    </a>
  </div>

  <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
    {% for t in top_translators|slice:":4" %}
    <a href="{% url 'accounts:translator_profile' t.user.username %}"
      class="group relative rounded-xl bg-gray-800 border border-gray-700 hover:border-amber-500 p-4 text-center transition shadow-sm hover:shadow-md focus:outline-none focus:ring-2 focus:ring-amber-500">
      <div class="relative mx-auto w-16 h-16 mb-3">
        {% if t.avatar %}
          <img src="{{ t.avatar.url }}" alt="{{ t.user.username }}"
              class="w-full h-full rounded-full object-cover border-2 border-amber-500">
        {% else %}
          <div class="w-full h-full rounded-full bg-gray-700 flex items-center justify-center border-2 border-amber-500">
            <span class="text-xl font-bold text-white">{{ t.user.username|first|upper }}</span>
          </div>
        {% endif %}
        <div class="absolute -bottom-2 right-0">
          <span class="inline-flex items-center px-2 py-0.5 rounded-md text-xs font-bold bg-purple-600 text-purple-50">
            #{{ forloop.counter }}
          </span>
        </div>
      </div>

      <h3 class="font-semibold text-white text-sm truncate" title="{{ t.user.username }}">{{ t.user.username }}</h3>

      <div class="mt-2 flex items-center justify-center gap-3 text-[11px] text-gray-300">
        <span class="inline-flex items-center gap-1" title="Loyihalar soni">
          <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor"><path d="M18 2H8a2 2 0 00-2 2v15a3 3 0 012-2.82V4h10v14h2V4a2 2 0 00-2-2zM6 6H4v14a2 2 0 002 2h10v-2H6V6z"/></svg>
          {{ t.manga_count|default:"0" }}
        </span>
        <span class="inline-flex items-center gap-1" title="Obunachilar">
          <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3zM8 11c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm8 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
          {{ t.follower_count|default:"0" }}
        </span>
        <span class="inline-flex items-center gap-1" title="Like/Thanks">
          <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12.1 8.64l-.1.1-.11-.1C10.14 6.6 7.1 6.24 5.14 8.2c-2.07 2.07-1.48 5.44 1.06 7.32L12 21l5.8-5.48c2.54-1.88 3.13-5.25 1.06-7.32-1.96-1.96-5-1.6-6.76.44z"/></svg>
          {{ t.likes_count|default:"0" }}
        </span>
      </div>
    </a>
    {% endfor %}
  </div>
</section>
{% endcache %}

{% cache 7200 latest_manga_section_carousel %}
<section aria-labelledby="latest-title" class="mb-10">
  <div class="flex items-center justify-between mb-3">
    <h2 id="latest-title" class="text-lg sm:text-xl font-semibold text-white tracking-tight">
      <span class="inline-flex items-center gap-2">
        <svg class="h-5 w-5 text-green-400" viewBox="0 0 24 24" fill="currentColor"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10S22 17.52 22 12 17.52 2 11.99 2z"/></svg>
        Yangi qo‘shilgan taytlar
      </span>
    </h2>
    <div class="flex items-center gap-2">
      <button id="latestPrev" class="navbtn" aria-label="Oldingi">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M15 19l-7-7 7-7" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button id="latestNext" class="navbtn" aria-label="Keyingi">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M9 5l7 7-7 7" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>

  <div id="latestRow" class="row-scroll no-scrollbar flex gap-3 overflow-x-auto snap-x snap-mandatory scroll-p-4 pr-1" role="list">
    {% for manga in latest_mangas %}
      <div role="listitem" class="snap-start w-36 sm:w-40 flex-shrink-0">
        <a href="{% url 'manga:manga_details' manga.slug %}" class="block">
          <div class="bg-gray-800 rounded-lg overflow-hidden shadow-lg transform transition-transform hover:scale-[1.03]">
            <div class="relative aspect-[3/4]">
              <img src="{{ manga.cover_image.url }}" alt="{{ manga.title }}" class="w-full h-full object-cover">
              <div class="absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black to-transparent">
                <h3 class="text-white text-sm font-semibold truncate">{{ manga.title }}</h3>
                <div class="mt-1 text-xs flex items-center justify-between">
                  <span class="text-gray-300">{{ manga.type }}</span>
                  <span class="text-purple-300">{{ manga.chapters.count }} Bob</span>
                </div>
              </div>
            </div>
          </div>
        </a>
      </div>
    {% endfor %}
  </div>
</section>
{% endcache %}

<section aria-labelledby="updates-title" class="mb-10">
  <div class="flex items-center justify-between mb-3">
    <h2 id="updates-title" class="text-lg sm:text-xl font-semibold text-white tracking-tight">
      <span class="inline-flex items-center gap-2">
        <svg class="h-5 w-5 text-sky-400" viewBox="0 0 24 24" fill="currentColor"><path d="M3 12l9-9 9 9-9 9-9-9z"/></svg>
        Yangi qo‘shilgan boblar
      </span>
    </h2>
    <div class="flex items-center gap-2">
      <button id="updatesPrev" class="navbtn" aria-label="Oldingi">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M15 19l-7-7 7-7" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button id="updatesNext" class="navbtn" aria-label="Keyingi">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M9 5l7 7-7 7" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>

  <div id="updatesRow" class="row-scroll no-scrollbar flex gap-3 overflow-x-auto snap-x snap-mandatory scroll-p-4 pr-1">
    {% for item in latest_updates %}
      {% with m=item.manga ch=item.chapter %}
      <div class="snap-start w-44 sm:w-48 flex-shrink-0">
        <a href="{% url 'manga:chapter_read' m.slug ch.volume ch.chapter_number %}">
          <div class="bg-gray-800 rounded-lg overflow-hidden shadow-lg">
            <div class="relative aspect-[3/4]">
              <img src="{{ m.cover_image.url }}" alt="{{ m.title }}" class="w-full h-full object-cover">
              <div class="absolute top-2 left-2">
                <span class="px-2 py-0.5 text-xs font-bold rounded-md bg-amber-600/90 text-white">Bob {{ ch.chapter_number }}</span>
              </div>
              <div class="absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black to-transparent">
                <h3 class="text-white text-sm font-semibold truncate">{{ m.title }}</h3>
                <div class="mt-1 text-xs text-gray-300">{{ ch.release_date|date:"d.m.Y" }}</div>
              </div>
            </div>
          </div>
        </a>
      </div>
      {% endwith %}
    {% endfor %}
  </div>
</section>

<section class="mb-10">
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-lg sm:text-xl font-semibold text-white tracking-tight">
      <span class="inline-flex items-center gap-2">
        <svg class="h-5 w-5 text-pink-400" viewBox="0 0 24 24" fill="currentColor"><path d="M3 3h18v2H3zM7 7h14v2H7zM3 11h18v2H3zM7 15h14v2H7zM3 19h18v2H3z"/></svg>
        TOP Kun
      </span>
    </h2>
    <div class="flex items-center justify-between mb-2">
      <div class="flex gap-2">
        <button id="topDayPrev" class="navbtn" aria-label="Oldingi">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M15 19l-7-7 7-7" fill="none" stroke="currentColor" stroke-width="2"
                  stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <button id="topDayNext" class="navbtn" aria-label="Keyingi">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M9 5l7 7-7 7" fill="none" stroke="currentColor" stroke-width="2"
                  stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <div class="mb-6">

    <div id="topDayRow" class="row-scroll no-scrollbar flex gap-3 snap-x snap-mandatory scroll-p-4 pr-1">
      {% for it in top_day %}
        <div class="snap-start w-44 sm:w-48 flex-shrink-0">
          <a href="{% url 'manga:manga_details' it.manga.slug %}">
            <div class="bg-gray-800 rounded-lg overflow-hidden shadow">
              <div class="relative aspect-[3/4]">
                <img src="{{ it.manga.cover_image.url }}" class="w-full h-full object-cover" alt="{{ it.manga.title }}">
                <div class="absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black to-transparent">
                  <h4 class="text-white text-sm font-semibold truncate">{{ it.manga.title }}</h4>
                </div>
              </div>
            </div>
          </a>
        </div>
      {% endfor %}
    </div>
  </div>
</section>

<section class="mb-4">
  <div class="flex items-center justify-between mb-3">
    <h2 class="text-lg sm:text-xl font-semibold text-white tracking-tight">
      <span class="inline-flex items-center gap-2">
        <svg class="h-5 w-5 text-red-400" viewBox="0 0 24 24" fill="currentColor"><path d="M12.1 8.64l-.1.1-.11-.1C10.14 6.6 7.1 6.24 5.14 8.2c-2.07 2.07-1.48 5.44 1.06 7.32L12 21l5.8-5.48c2.54-1.88 3.13-5.25 1.06-7.32-1.96-1.96-5-1.6-6.76.44z"/></svg>
        Eng ko‘p like bosilgan taytlar
      </span>
    </h2>
    <div class="flex gap-2">
      <button id="topLikedPrev" class="navbtn" aria-label="Oldingi">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M15 19l-7-7 7-7" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button id="topLikedNext" class="navbtn" aria-label="Keyingi">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M9 5l7 7-7 7" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>

  <div id="topLikedRow" class="row-scroll no-scrollbar flex gap-3 snap-x snap-mandatory scroll-p-4 pr-1">
    {% for manga in top_liked %}
      <div class="snap-start w-44 sm:w-48 flex-shrink-0">
        <a href="{% url 'manga:manga_details' manga.slug %}">
          <div class="bg-gray-800 rounded-lg overflow-hidden shadow">
            <div class="relative aspect-[3/4]">
              <img src="{{ manga.cover_image.url }}" class="w-full h-full object-cover" alt="{{ manga.title }}">
              <div class="absolute top-2 left-2">
                <span class="px-2 py-0.5 text-xs font-bold rounded-md bg-red-600/90 text-white">
                  ❤ {{ manga.likes_sum|default:"0" }}
                </span>
              </div>
              <div class="absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black to-transparent">
                <h4 class="text-white text-sm font-semibold truncate">{{ manga.title }}</h4>
              </div>
            </div>
          </div>
        </a>
      </div>
    {% endfor %}
  </div>
</section>

</div>

<script>
  (function () {
    function setupScroller(rowId, prevId, nextId) {
      const row  = document.getElementById(rowId);
      const prev = document.getElementById(prevId);
      const next = document.getElementById(nextId);
      if (!row || !prev || !next) return;

      const update = () => {
        const max = row.scrollWidth - row.clientWidth - 1;
        prev.disabled = row.scrollLeft <= 0;
        next.disabled = row.scrollLeft >= max;
      };

      prev.addEventListener('click', () => row.scrollBy({ left: -row.clientWidth, behavior: 'smooth' }));
      next.addEventListener('click', () => row.scrollBy({ left:  row.clientWidth, behavior: 'smooth' }));
      row.addEventListener('scroll', update);
      window.addEventListener('resize', update);
      update();
    }

    // My list tabs (agar bor bo'lsa)
    setupScroller('myReadingRow',  'myReadingPrev',  'myReadingNext');
    setupScroller('myPlannedRow',  'myPlannedPrev',  'myPlannedNext');
    setupScroller('myCompletedRow','myCompletedPrev','myCompletedNext');
    setupScroller('myFavoriteRow', 'myFavoritePrev', 'myFavoriteNext');

    // Sections
    setupScroller('trendingRow', 'trendingPrev', 'trendingNext');
    setupScroller('latestRow',   'latestPrev',   'latestNext');
    setupScroller('updatesRow',  'updatesPrev',  'updatesNext');
    setupScroller('topDayRow',   'topDayPrev',   'topDayNext');
    setupScroller('topWeekRow',  'topWeekPrev',  'topWeekNext');
    setupScroller('topMonthRow', 'topMonthPrev', 'topMonthNext');
    setupScroller('topLikedRow', 'topLikedPrev', 'topLikedNext');
  })();
</script>
{% endblock %}
