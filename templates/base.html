{% load static %}
<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="csrf-token" content="{{ csrf_token }}">
  <meta name="description" content="MangaLab - O'zbek tilidagi eng yirik komikslar platformasi.">
  <meta name="keywords" content="manga, komiks, o'zbek, platforma, manga lab, manga uzbek">
  <meta name="author" content="MangaLab Team">

  <link rel="icon" href="{% static 'images/logo.png' %}">
  {% block head_extra %}{% endblock %}
  <title>{% block title %}MangaLab{% endblock %}</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Alpine.js -->
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <!-- Hide [x-cloak] elements until Alpine is ready -->
  <style>[x-cloak] { display: none !important; }</style>
  <!-- Font Awesome (footer ikonlar uchun) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js" defer></script>

  <!-- Toastify CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

  <style>
    :root {
      --bg-color: #1a202c;
      --text-color: #edf2f7;
      --navbar-bg: #2d3748;
      --hover-color: #6b46c1;
      --card-bg: #2d3748;
      --card-border: #4a5568;
      --transition-speed: 0.3s;
    }
    html, body { height: 100%; }
    body {
      display: flex; flex-direction: column;
      background-color: var(--bg-color); color: var(--text-color);
    }
    main { flex-grow: 1; }
    nav, footer { background-color: var(--navbar-bg); }
    .btn { background-color: var(--hover-color); color: #fff; padding: 0.5rem 1rem; border-radius: 0.375rem; transition: all var(--transition-speed); }
    .btn:hover { opacity: 0.9; transform: translateY(-1px); }
    .avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
  </style>
</head>

<body
  class="flex flex-col min-h-screen"
  x-data="{ showLogoutModal: false, mobileMenuOpen: false }"
  :class="{ 'overflow-hidden': mobileMenuOpen }"
  @keydown.escape="mobileMenuOpen = false; showLogoutModal = false"
>

  <!-- Logout overlay -->
  <div
    x-cloak
    x-show="showLogoutModal"
    x-transition:enter="transition ease-out duration-200"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition ease-in duration-200"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    class="fixed inset-0 bg-black/50 z-50">
  </div>

  <!-- Logout modal -->
  <div
    x-cloak
    x-show="showLogoutModal"
    x-transition:enter="transition ease-out duration-200"
    x-transition:enter-start="opacity-0 translate-y-4"
    x-transition:enter-end="opacity-100 translate-y-0"
    x-transition:leave="transition ease-in duration-200"
    x-transition:leave-start="opacity-100 translate-y-0"
    x-transition:leave-end="opacity-0 translate-y-4"
    class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2
           bg-gray-800 rounded-lg p-6 z-50 w-96">
    <h3 class="text-xl font-semibold mb-4">Chiqishni tasdiqlang</h3>
    <p class="text-gray-300 mb-6">Haqiqatan ham chiqmoqchimisiz?</p>
    <div class="flex justify-end space-x-4">
      <button
        @click="showLogoutModal = false"
        class="px-4 py-2 text-gray-300 hover:text-white transition-colors">
        Bekor qilish
      </button>
      <form method="post" action="{% url 'accounts:logout' %}">
        {% csrf_token %}
        <button type="submit" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-500 transition-colors">
          Chiqish
        </button>
      </form>
    </div>
  </div>

  <!-- Navbar -->
  <nav class="shadow-lg bg-gray-900/80 backdrop-blur border-b border-gray-800">
    <div class="container mx-auto flex items-center justify-between px-6 py-4">
      <!-- Chap: logo -->
      <div class="flex items-center">
        <a href="{% url 'manga:discover' %}"
           class="text-2xl font-bold text-white hover:text-purple-400">
          MangaLab
        </a>
      </div>

      <!-- O'ng: profil/login + burger -->
      <div class="flex items-center space-x-2">
        {% if user.is_authenticated %}
          <!-- Profile -->
          <a href="{% url 'accounts:my_profile' %}"
             class="p-2 rounded-full text-gray-300 hover:text-purple-400"
             title="Profil" aria-label="Profil">
            {% if user.avatar_url %}
              <img src="{{ user.avatar_url }}" alt="Profil" class="w-8 h-8 rounded-full border-2 border-transparent">
            {% else %}
              <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none"
                   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 21a8 8 0 1 0-16 0"></path>
                <circle cx="12" cy="8" r="4"></circle>
              </svg>
            {% endif %}
          </a>

          <!-- Logout -->
          <button type="button"
                  @click="showLogoutModal = true"
                  class="p-2 rounded-full text-gray-300 hover:text-purple-400"
                  title="Chiqish" aria-label="Chiqish">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
          </button>
        {% else %}
          <!-- Login -->
          <a href="{% url 'accounts:login' %}"
             class="p-2 rounded-full text-gray-300 hover:text-purple-400"
             title="Kirish" aria-label="Kirish">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
              <polyline points="10 17 15 12 10 7"></polyline>
              <line x1="15" y1="12" x2="3" y2="12"></line>
            </svg>
          </a>
        {% endif %}

        <!-- Burger (o'ng tomonda) -->
        <button
          type="button"
          @click="mobileMenuOpen = true"
          class="p-2 ml-1 rounded-full text-gray-300 hover:text-purple-400"
          aria-label="Menyuni ochish" title="Menyuni ochish">
          <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none"
               stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="3" y1="6"  x2="21" y2="6"></line>
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </button>
      </div>
    </div>
  </nav>

  <!-- Burger overlay -->
  <div
    x-cloak
    x-show="mobileMenuOpen"
    @click="mobileMenuOpen = false"
    x-transition.opacity
    class="fixed inset-0 bg-black/50 z-40">
  </div>

<!-- Burger drawer -->
<!-- Burger drawer -->
<aside
  x-cloak
  x-show="mobileMenuOpen"
  x-transition:enter="transform transition ease-out duration-200"
  x-transition:enter-start="-translate-x-full"
  x-transition:enter-end="translate-x-0"
  x-transition:leave="transform transition ease-in duration-200"
  x-transition:leave-start="translate-x-0"
  x-transition:leave-end="-translate-x-full"
  class="fixed top-0 left-0 h-full w-80 sm:w-96 z-50
         bg-gray-900 border-r border-gray-800 shadow-2xl flex flex-col"
  aria-label="Yon menyu"
>
  <!-- Header -->
  <div class="flex items-center justify-between px-4 py-4 border-b border-gray-800">
    <div class="flex items-center gap-2">
      <span class="text-white font-bold text-lg">Menyu</span>
    </div>
    <button
      @click="mobileMenuOpen = false"
      class="p-2 rounded-full text-gray-300 hover:text-white hover:bg-gray-800 transition"
      aria-label="Yopish" title="Yopish">
      <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none"
           stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <!-- Tez qidiruv -->
  <div class="px-4 pt-4">
    <form method="get" action="{% url 'manga:browse' %}" class="flex">
      <input
        type="text" name="search" placeholder="Tez qidiruv..."
        autocomplete="off"
        class="w-full rounded-l-md px-3 py-2 bg-white/95 text-gray-900 border border-gray-300
               focus:outline-none focus:ring-2 focus:ring-purple-500"
      />
      <button type="submit"
        class="rounded-r-md px-3 py-2 bg-purple-600 text-white hover:bg-purple-500 active:scale-[.98] transition">
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </button>
    </form>
  </div>

  <!-- Menyu ro'yxati -->
  <nav class="mt-4 px-2 py-4 overflow-y-auto">
    {% with current=request.resolver_match.url_name %}
    <ul class="space-y-1 text-gray-200 ">
      <!-- Katalog (Browse) -->
      <li>
        <a href="{% url 'manga:browse' %}"
           {% if current == 'browse' %}aria-current="page"{% endif %}
           class="group flex items-center gap-3 px-3 py-2 rounded-md border border-transparent
                  hover:border-gray-700 hover:bg-gray-800/70 hover:translate-x-0.5
                  transition-all duration-150 {% if current == 'browse' %}bg-gray-800/60 border-gray-700{% endif %}">
          <svg class="w-5 h-5 shrink-0" viewBox="0 0 24 24" fill="none"
               stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3"  y="3"  width="7" height="7" rx="1"></rect>
            <rect x="14" y="3"  width="7" height="7" rx="1"></rect>
            <rect x="3"  y="14" width="7" height="7" rx="1"></rect>
            <rect x="14" y="14" width="7" height="7" rx="1"></rect>
          </svg>
          <span class="font-medium">Katalog</span>
          <span class="ml-auto opacity-0 group-hover:opacity-100 transition text-xs text-gray-400">Barcha taytlar</span>
        </a>
      </li>

      <!-- Discover -->
      <li>
        <a href="{% url 'manga:discover' %}"
           {% if current == 'discover' %}aria-current="page"{% endif %}
           class="group flex items-center gap-3 px-3 py-2 rounded-md border border-transparent
                  hover:border-gray-700 hover:bg-gray-800/70 hover:translate-x-0.5
                  transition-all duration-150 {% if current == 'discover' %}bg-gray-800/60 border-gray-700{% endif %}">
          <svg class="w-5 h-5 shrink-0" viewBox="0 0 24 24" fill="none"
               stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="9"></circle>
            <path d="M16 8l-4 9-1-4-4-1 9-4z"></path>
          </svg>
          <span class="font-medium">Sayohat</span>
          <span class="ml-auto opacity-0 group-hover:opacity-100 transition text-xs text-gray-400">Yangi & trend</span>
        </a>
      </li>

      <!-- Yangiliklar -->
      <li>
        <a href="#"
           class="group flex items-center gap-3 px-3 py-2 rounded-md border border-transparent
                  hover:border-gray-700 hover:bg-gray-800/70 hover:translate-x-0.5 transition-all duration-150">
          <svg class="w-5 h-5 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21H5a2 2 0 0 1-2-2V7h18v12a2 2 0 0 1-2 2z"></path>
            <path d="M16 3v4M8 3v4M3 11h18"></path>
          </svg>
          <span class="font-medium">Yangiliklar</span>
        </a>
      </li>

      <!-- E'lonlar -->
      <li>
        <a href="#"
           class="group flex items-center gap-3 px-3 py-2 rounded-md border border-transparent
                  hover:border-gray-700 hover:bg-gray-800/70 hover:translate-x-0.5 transition-all duration-150">
          <svg class="w-5 h-5 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 11l19-7-7 19-2-8-8-4z"></path>
          </svg>
          <span class="font-medium">E’lonlar</span>
        </a>
      </li>

      <!-- Tarjimonlar -->
      <li>
        <a href="{% url 'accounts:top_translators' %}"
           class="group flex items-center gap-3 px-3 py-2 rounded-md border border-transparent
                  hover:border-gray-700 hover:bg-gray-800/70 hover:translate-x-0.5 transition-all duration-150">
          <svg class="w-5 h-5 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 11a3 3 0 1 0-3-3a3 3 0 0 0 3 3zM8 11a3 3 0 1 0-3-3a3 3 0 0 0 3 3z"></path>
            <path d="M8 13c-2.7 0-8 1.3-8 4v2h6v-2.5c0-.7.3-1.3.7-1.8.5-.7.9-1 1.3-1zM16 13c-2.3 0-7 1.2-7 3.5V19h14v-2.5c0-2.3-4.7-3.5-7-3.5z"></path>
          </svg>
          <span class="font-medium">Tarjimonlar</span>
        </a>
      </li>

<!-- Janrlar -->
<li>
  <a href="{% url 'manga:genre_index' %}"
     class="group flex items-center gap-3 px-3 py-2 rounded-md border border-transparent
            hover:border-gray-700 hover:bg-gray-800/70 hover:translate-x-0.5 transition-all duration-150">
    <!-- icon -->
    <svg class="w-5 h-5 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20M4 4v15.5A2.5 2.5 0 0 1 6.5 22H20V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2z"/>
    </svg>
    <span class="font-medium">Janrlar</span>
  </a>
</li>

<!-- Teglar -->
<li>
  <a href="{% url 'manga:tag_index' %}"
     class="group flex items-center gap-3 px-3 py-2 rounded-md border border-transparent
            hover:border-gray-700 hover:bg-gray-800/70 hover:translate-x-0.5 transition-all duration-150">
    <!-- icon -->
    <svg class="w-5 h-5 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M20.59 13.41L12 22l-8.59-8.59A2 2 0 0 1 3 12V5a2 2 0 0 1 2-2h7a2 2 0 0 1 1.41.59l7.18 7.18a2 2 0 0 1 0 2.82z"/>
      <circle cx="7.5" cy="7.5" r="1.5"/>
    </svg>
    <span class="font-medium">Teglar</span>
  </a>
</li>

    </ul>
    {% endwith %}
  </nav>

  <!-- Pastki bo'lim: markazda joylashgan Random + Telegram -->
  <div class="mt-auto px-4 pb-8 pt-6 border-t border-gray-800 bg-gray-900/60">
    <div class="flex flex-col items-center text-center gap-4">
      <!-- Tasodifiy taytl (PURPLE) -->
      <a href="{% url 'manga:random_manga' %}"
         class="inline-flex items-center justify-center gap-2 px-5 py-3
                rounded-xl bg-purple-600 hover:bg-purple-500 active:scale-[.98]
                text-white font-semibold transition shadow-md w-full max-w-[260px]">
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="7" height="7" rx="1"></rect>
          <rect x="14" y="14" width="7" height="7" rx="1"></rect>
          <path d="M14 3h7v7M3 14h7v7"></path>
        </svg>
        Tasodifiy taytl
      </a>

      <!-- Social / Telegram (BLUE) -->
      <div class="pt-2">
        <p class="text-gray-400 text-sm mb-2">Biz bilan bo‘ling:</p>
        <a href="https://t.me/mangalabuz" target="_blank" rel="noopener nofollow"
           class="inline-flex items-center gap-2 px-4 py-2 rounded-lg
                  bg-sky-600 hover:bg-sky-500 text-white transition shadow">
          <!-- Yangi telegram/plane ikonkasi -->
          <span class="font-medium">Telegram</span>
        </a>
      </div>
    </div>
  </div>
</aside>




  <!-- Main Content -->
  <main class="flex-grow">
    {% block content %}{% endblock %}
  </main>

  <!-- Footer -->
  <footer class="py-12 bg-gray-900 border-t border-gray-800">
    <div class="container mx-auto px-6">
      <div class="space-y-4">
        <h3 class="text-white text-xl">
          MangaLab -
          <span class="text-gray-600 text-sm">
            Manga, manhwa va manhua - endi o'zbek tilida! Yangi o'qish platformasi
          </span>
        </h3>
        <p class="text-gray-400 text-sm">
          Savollaringiz bo'lsa, yozing:
          <a href="mailto:yordam@mangalab.uz" class="text-purple-400 hover:underline">yordam@mangalab.uz</a>
        </p>

        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-4 sm:space-y-0">
          <div class="flex space-x-4">
            <a href="https://t.me/mangalabuz" class="text-gray-400 hover:text-purple-500"><i class="fab fa-telegram-plane fa-lg"></i></a>
            <a href="https://www.tiktok.com/@mangalabuz" class="text-gray-400 hover:text-purple-500"><i class="fab fa-tiktok fa-lg"></i></a>
            <a href="#" class="text-gray-400 hover:text-purple-500"><i class="fab fa-instagram fa-lg"></i></a>
          </div>
          <p class="text-gray-500 text-sm">© {% now "Y" %} MangaLab. Barcha huquqlar himoyalangan</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Toastify JS -->
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  {% if messages %}
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        {% for message in messages %}
          Toastify({
            text: "{{ message|escapejs }}",
            duration: 5000,
            close: true,
            gravity: "top",
            position: "center",
            stopOnFocus: true,
            style: {
              background: "rgba(58, 53, 65, 0.95)",
              color: "#f7f7f7",
              borderRadius: "0.5rem",
              boxShadow: "0 8px 16px rgba(0,0,0,0.3)",
              fontSize: "1rem",
              padding: "0.75rem 1.25rem",
              fontFamily: "Inter, system-ui, -apple-system"
            },
            backgroundColor: "#8b5cf6"
          }).showToast();
        {% endfor %}
      });
    </script>
  {% endif %}

  <!-- Smooth scroll for anchors (#genres/#tags) -->
  <script>
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function(e) {
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          e.preventDefault();
          target.scrollIntoView({ behavior: 'smooth' });
        }
      });
    });
  </script>
  <script>
  document.addEventListener('DOMContentLoaded', function () {
    var scale = 0.75;
    var body = document.body;

    // Prefer browser zoom (better for fixed/positioned elements)
    body.style.zoom = scale;

    // Fallback for browsers that don't support zoom (e.g., Firefox)
    if (!body.style.zoom) {
      var wrap = document.createElement('div');
      while (body.firstChild) wrap.appendChild(body.firstChild);
      wrap.style.transform = 'scale(' + scale + ')';
      wrap.style.transformOrigin = 'top center';
      wrap.style.width = (100 / scale) + '%';
      wrap.style.minHeight = (100 / scale) + 'vh';
      body.appendChild(wrap);
      body.style.overflowX = 'hidden';
    }
  });
</script>
</body>
</html>
